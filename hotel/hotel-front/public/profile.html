<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>个人中心</title>
    <style>
        body { font-family: '微软雅黑', Arial, sans-serif; background: #f7f7f7; margin: 0; }
        .container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #eee; padding: 32px; }
        h2 { text-align: center; color: #333; }
        .user-info { margin-bottom: 32px; border-bottom: 1px solid #eee; padding-bottom: 24px; }
        .user-info span { display: inline-block; min-width: 120px; color: #555; font-size: 16px; margin-right: 30px; }
        .logout-btn { float: right; background: #e53935; color: #fff; border: none; border-radius: 4px; padding: 8px 18px; cursor: pointer; }
        .notice-list { margin-top: 24px; }
        .notice-item { border-bottom: 1px solid #eee; padding: 16px 0; }
        .notice-item:last-child { border-bottom: none; }
        .notice-title { font-weight: bold; color: #1976d2; }
        .notice-time { color: #888; font-size: 13px; float: right; }
        .notice-content { margin-top: 8px; color: #444; }
    </style>
    <script>
        function getUserInfo() {
            // ajax获取用户信息
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://127.0.0.1:8081/member/profile', true);
            xhr.withCredentials = true;
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var res = JSON.parse(xhr.responseText);
                        if (res.success && res.data) {
                            document.getElementById('username').innerText = res.data.username;
                            document.getElementById('realName').innerText = res.data.realName;
                            document.getElementById('phone').innerText = res.data.phone;
                        } else {
                            alert('请先登录');
                            window.location.href = 'login.html';
                        }
                    } else {
                        alert('获取用户信息失败');
                    }
                }
            };
            xhr.send();
        }
        function logout() {
            // 清除本地存储并跳转到登录页
            localStorage.clear();
            window.location.href = 'login.html';
        }
        function getNotices() {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'http://127.0.0.1:8081/notice/list', true);
            xhr.withCredentials = true;
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        var res = JSON.parse(xhr.responseText);
                        if (res.success && res.data) {
                            renderNotices(res.data);
                        }
                    }
                }
            };
            xhr.send();
        }
        function renderNotices(notices) {
            var list = document.getElementById('noticeList');
            list.innerHTML = '';
            if (!notices || notices.length === 0) {
                list.innerHTML = '<div style="color:#888;text-align:center;">暂无通知</div>';
                return;
            }
            notices.forEach(function(n) {
                var item = document.createElement('div');
                item.className = 'notice-item';
                item.innerHTML = '<span class="notice-title">' + n.title + '</span>' +
                    '<span class="notice-time">' + (n.noticeTime ? n.noticeTime.replace('T', ' ').substring(0, 16) : '') + '</span>' +
                    '<div class="notice-content">' + n.content + '</div>';
                list.appendChild(item);
            });
        }
        window.onload = function() {
            getUserInfo();
            getNotices();
        }
    </script>
</head>
<body>
    <div class="container">
        <h2>个人中心</h2>
        <div class="user-info">
            <span>用户名：<b id="username"></b></span>
            <span>姓名：<b id="realName"></b></span>
            <span>手机号：<b id="phone"></b></span>
            <button class="logout-btn" onclick="logout()">退出登录</button>
            <div style="clear:both;"></div>
        </div>
        <h3>我的通知</h3>
        <div class="notice-list" id="noticeList">
            <!-- 可后续用ajax动态加载通知 -->
            <div class="notice-item">
                <span class="notice-title">订单被管理员删除</span>
                <span class="notice-time">2024-05-01 10:00</span>
                <div class="notice-content">您的订单（房间：101，入住：2024-05-10，离店：2024-05-12）已被管理员删除，如有疑问请联系客服。</div>
            </div>
            <div class="notice-item">
                <span class="notice-title">欢迎入住本酒店</span>
                <span class="notice-time">2024-04-28 09:30</span>
                <div class="notice-content">感谢您的预订，祝您入住愉快！</div>
            </div>
        </div>
    </div>
</body>
</html> 